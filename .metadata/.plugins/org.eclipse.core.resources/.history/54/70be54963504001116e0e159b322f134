const BASE_URL = "/api/requests";
const token = localStorage.getItem("token");

// =====================
// CREATE REQUEST (Rajesh)
// =====================
function createRequest() {

  const requestData = {
    title: document.getElementById("title").value,
    description: document.getElementById("description").value,
    amount: document.getElementById("amount").value
  };

  fetch(`${BASE_URL}`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + token
    },
    body: JSON.stringify(requestData)
  })
  .then(res => {
    if (!res.ok) {
      throw new Error("Failed to create request");
    }
    alert("Request submitted successfully");
  })
  .catch(err => alert(err.message));
}

// =====================
// LOAD PENDING REQUESTS (Amit)
// =====================
function loadPendingRequests() {

  fetch(`${BASE_URL}/pending`, {
    headers: {
      "Authorization": "Bearer " + token
    }
  })
  .then(res => res.json())
  .then(data => {

    const container = document.getElementById("requests");
    container.innerHTML = "";

    data.forEach(req => {
      container.innerHTML += `
        <div class="card">
          <h4>${req.title}</h4>
          <p>${req.description}</p>
          <p><b>Amount:</b> ${req.amount}</p>
          <p>
            <span style="color:orange;font-weight:bold">
              ${req.status}
            </span>
          </p>

          <input id="remarks-${req.id}" placeholder="Remarks">

          <button onclick="approve(${req.id})">Approve</button>
          <button class="reject" onclick="reject(${req.id})">Reject</button>
        </div>
      `;
    });
  });
}

// =====================
// APPROVE REQUEST
// =====================
function approve(requestId) {

  const remarks =
    document.getElementById(`remarks-${requestId}`).value;

  fetch(`${BASE_URL}/${requestId}/approve?remarks=${remarks}`, {
    method: "PUT",
    headers: {
      "Authorization": "Bearer " + token
    }
  })
  .then(() => {
    alert("Request approved");
    loadPendingRequests();
  });
}

// =====================
// REJECT REQUEST
// =====================
function reject(requestId) {

  const remarks =
    document.getElementById(`remarks-${requestId}`).value;

  fetch(`${BASE_URL}/${requestId}/reject?remarks=${remarks}`, {
    method: "PUT",
    headers: {
      "Authorization": "Bearer " + token
    }
  })
  .then(() => {
    alert("Request rejected");
    loadPendingRequests();
  });
}
